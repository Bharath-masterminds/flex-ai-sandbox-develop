{
  "resourceType": "Organization",
  {% if id %}
  "id": "{{ id }}",
  {% endif %}
  {% if identifier and identifier.size > 0 %}
  "identifier": [
    {% for ident in identifier %}
    {
      {% if ident.use %}
      "use": "{{ ident.use }}",
      {% endif %}
      {% if ident.type and ident.type.text %}
      "type": {
        "text": "{{ ident.type.text }}"
      },
      {% endif %}
      {% if ident.system %}
      "system": "{{ ident.system }}",
      {% endif %}
      {% if ident.value %}
      "value": "{{ ident.value }}"
      {% endif %}
    }{% if forloop.last == false %},{% endif %}
    {% endfor %}
  ],
  {% endif %}
  {% if active != nil %}
  "active": {{ active | json }},
  {% endif %}
  {% if name %}
  "name": "{{ name }}",
  {% endif %}
  {% if telecom and telecom.size > 0 %}
  "telecom": [
    {% for t in telecom %}
    {
      {% if t.system %}
      "system": "{{ t.system }}",
      {% endif %}
      {% if t.value %}
      "value": "{{ t.value }}",
      {% endif %}
      {% if t.use %}
      "use": "{{ t.use }}"
      {% endif %}
    }{% if forloop.last == false %},{% endif %}
    {% endfor %}
  ],
  {% endif %}
  {% if address and address.size > 0 %}
  "address": [
    {% for addr in address %}
    {
      {% if addr.text %}
      "text": "{{ addr.text }}",
      {% endif %}
      {% if addr.line and addr.line.size > 0 %}
      "line": [
        {% for l in addr.line %}
        "{{ l }}"{% if forloop.last == false %},{% endif %}
        {% endfor %}
      ],
      {% endif %}
      {% if addr.city %}
      "city": "{{ addr.city }}",
      {% endif %}
      {% assign state_map = 
        {
          "Alabama":"AL","Alaska":"AK","Arizona":"AZ","Arkansas":"AR","California":"CA","Colorado":"CO","Connecticut":"CT","Delaware":"DE","Florida":"FL","Georgia":"GA","Hawaii":"HI","Idaho":"ID","Illinois":"IL","Indiana":"IN","Iowa":"IA","Kansas":"KS","Kentucky":"KY","Louisiana":"LA","Maine":"ME","Maryland":"MD","Massachusetts":"MA","Michigan":"MI","Minnesota":"MN","Mississippi":"MS","Missouri":"MO","Montana":"MT","Nebraska":"NE","Nevada":"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND","Ohio":"OH","Oklahoma":"OK","Oregon":"OR","Pennsylvania":"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD","Tennessee":"TN","Texas":"TX","Utah":"UT","Vermont":"VT","Virginia":"VA","Washington":"WA","West Virginia":"WV","Wisconsin":"WI","Wyoming":"WY","District of Columbia":"DC"
        }
      %}
      {% if addr.state %}
      {% assign state_code = state_map[addr.state] %}
      "state": "{% if state_code %}{{ state_code }}{% else %}{{ addr.state }}{% endif %}",
      {% endif %}
      {% if addr.postalCode %}
      "postalCode": "{{ addr.postalCode }}",
      {% endif %}
      {% if addr.country %}
      {% assign country_code = "" %}
      {% if addr.country == "United States of America" or addr.country == "USA" or addr.country == "United States" %}
        {% assign country_code = "US" %}
      {% else %}
        {% assign country_code = addr.country %}
      {% endif %}
      "country": "{{ country_code }}"
      {% endif %}
    }{% if forloop.last == false %},{% endif %}
    {% endfor %}
  ]
  {% endif %}
}